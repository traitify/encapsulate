<html>
<head>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" />
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<link href="http://bootswatch.com/cerulean/bootstrap.min.css" rel="stylesheet" />
<script src='http://cdn.ractivejs.org/latest/ractive.js'></script>
<script src="/encapsulate.js"></script>
<script src="/assets/main.js"></script>
<link href="/assets/main.css" rel="stylesheet" />

</head>
<body>
  <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <li>
          <a href="#/names">The Book Store</a>
        </li>
        <ul class="nav navbar-nav">
          <li>
            <a href="#/Authors">Authors</a>
          </li>
          <li>
            <a href="#/books">Books</a>
          </li>
        </ul>
      </div>
  </div>
  <div class="container">
    <div class="main">
    </div>
  </div>
  <template name="authors">
    {{#authors }}
      <div class="author">{{name}}</div>
    {{/authors }}
    <div class="form" data-name="author" >
      <input type="text" data-name="name" placeholder="Name" />
      <div class="submit btn btn-primary">Submit</div>
    </div>
  </template>
  <template name="books">
    {{#books }}
      <div class="book">{{title}}</div>
    {{/books }}
    <div class="form" data-name="book" >
      <input type="text" data-name="title" placeholder="Title"  />
      <div class="submit btn btn-primary">Submit</div>
    </div>
  </template>
</body>
</html>

$.capsuleForm = (function(selector){
  
  $(document).on("click", selector + " .form .submit", function(){
    submitData = Object();
    $form = $(this).parents(".form");
    key = $form.data("name");
    submitData[key] = Object();
    $form.find("input").each(function(i, input){
      submitData[key][$(this).data("name")] = $(this).val()
    })
    formName = selector.replace(".", "");
    $.post("/api/collections/" + formName, submitData, function(data){
      View.render(".main", formName, "/collections/"+ formName)
    })
  })

})